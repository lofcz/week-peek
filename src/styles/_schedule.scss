@use 'variables' as *;
@use 'mixins' as *;

/**
 * Main schedule grid layout - left headers + right content
 */
 .weekly-schedule {
  --header-height: $day-header-height;
  --cross-axis-width: $time-axis-width;
  
  display: grid;
  grid-template-columns: var(--cross-axis-width) 1fr;
  grid-template-rows: var(--header-height) 1fr;
  background: var(--schedule-bg-color, $color-bg);
  border: 1px solid var(--schedule-grid-line-color, $color-border);
  border-radius: 8px;
  overflow: hidden;
  font-family: var(--schedule-font-family, $font-family);
  min-width: 0; // Prevent grid overflow
 }

 .schedule-intersection {
  grid-column: 1;
  grid-row: 1;
 }

 .axis-vertical {
  grid-column: 1;
  grid-row: 2;
 }

 .schedule-scroll {
  grid-column: 2;
  grid-row: 1 / span 2;
  display: grid;
  grid-template-rows: var(--header-height) 1fr;
  width: 100%;
  height: 100%;
  overflow: hidden; // normal mode default
 }



.weekly-schedule.zoomed.horizontal .schedule-scroll {
  overflow-x: auto;
  overflow-y: hidden;
}

.weekly-schedule.zoomed.vertical .schedule-scroll {
  overflow-y: auto;
  overflow-x: hidden;
}


/**
 * Intersection cell (top-left corner)
 */
 .schedule-intersection {
  background: var(--schedule-bg-color, $color-bg-header);
  border-right: 1px solid var(--schedule-grid-line-color, $color-border);
  border-bottom: 1px solid var(--schedule-grid-line-color, $color-border);
  display: flex;
  align-items: center;
  gap: $spacing-sm;
  padding: 0 $spacing-sm;
 }

 .zoom-reset-btn {
  appearance: none;
  border: none;
  background: transparent;
  color: var(--schedule-header-text-color, $color-text-primary);
  font-weight: $font-weight-medium;
  cursor: pointer;
 }




/**
 * Flex container for axes
 * Base styles for both horizontal and vertical axes
 */
 .axis-horizontal,
 .axis-vertical {
   background: var(--schedule-bg-color, $color-bg-alt);
 }

 .axis-horizontal {
   border-bottom: 1px solid var(--schedule-grid-line-color, $color-border);
 }

 .axis-vertical {
   border-right: 1px solid var(--schedule-grid-line-color, $color-border);
 }


/**
 * Horizontal axis (day headers or time labels)
 */


 // Normal mode: fluid columns
 .weekly-schedule.horizontal .axis-horizontal {
   grid-template-columns: repeat(var(--num-columns, 8), 1fr);
 }

 // Fixed hour width in zoomed horizontal mode
 .weekly-schedule.zoomed.horizontal .axis-horizontal {
   grid-template-columns: repeat(var(--num-columns, 8), var(--hour-col-width, 160px));
   width: max-content;
 }



/**
 * Vertical axis (time labels)
 */
.axis-vertical {
  display: flex;
  flex-direction: column;
  min-height: 0; // Allow flex to shrink
  
  // Dividers between children
  > * {
    border-bottom: 1px solid var(--schedule-grid-line-color, $color-border);
    flex: 1; // Stretch to fill available space
    min-height: 0; // Allow shrinking
    
    &:last-child {
      border-bottom: none;
    }
  }
}

/**
 * Time label
 */
 .time-label {
  display: inline-block;
  font-size: $font-size-sm;
  color: var(--schedule-time-text-color, $color-text-secondary);
  background: var(--schedule-bg-color, $color-bg-alt);
  padding: 0 $spacing-xs;
  pointer-events: none; // labels are informational
 }

  /* Left-aligned time labels; border-left renders tick */
 .weekly-schedule.horizontal .axis-horizontal {
  display: flex;
  flex-direction: row;
  min-width: 0;
 }
 .weekly-schedule.horizontal .axis-horizontal > .time-label {
  flex: 1 1 0;
  display: flex;
  align-items: center;
  justify-content: flex-start;
  padding-left: $spacing-sm;
  border-left: 1px solid var(--schedule-grid-line-color, $color-border);
 }
 .weekly-schedule.horizontal .axis-horizontal > .time-label:first-child {
  border-left: 1px solid var(--schedule-grid-line-color, $color-border); // keep start tick
 }
 .weekly-schedule.zoomed.horizontal .axis-horizontal > .time-label {
  flex: 0 0 var(--hour-col-width, 160px);
 }

 .weekly-schedule.vertical .axis-vertical {
  display: grid;
  grid-auto-flow: row;
  grid-auto-rows: 1fr;
 }
 .weekly-schedule.vertical .axis-vertical .time-label {
  align-self: flex-start;
 }
 .weekly-schedule.zoomed.vertical .axis-vertical {
  grid-template-rows: repeat(var(--num-rows), var(--slot-row-height, 48px));
 }


/**
 * Day header
 */
 .day-header {
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: $font-weight-semibold;
  font-size: $font-size-sm;
  color: var(--schedule-header-text-color, $color-text-primary);
  background: var(--schedule-bg-color, $color-bg-header);
  padding: $spacing-sm $spacing-md;
  flex: 1;
  cursor: pointer;
  
  // Horizontal orientation: headers are in vertical axis
  .axis-vertical & {
    height: $day-header-height; // Match header height
  }
 }

 .weekly-schedule.zoomed .day-header.selected {
  background: rgba($color-primary, 0.15);
 }


/**
 * Events grid - nested grid containing only events
 */
 .events-grid {
   --line-thickness: 1px;
   display: grid;
   grid-template-columns: repeat(var(--num-columns, 5), 1fr);
   grid-template-rows: repeat(var(--num-rows, 8), minmax(0, 1fr));
   position: relative;
   min-height: 0;
   width: 100%;
   height: 100%;
   overflow: hidden; // events themselves are absolutely positioned
 }

 // Grid lines moved to scroll container children (optional). Keep existing if needed.
 .events-grid::after,
 .events-grid::before {
   content: none;
 }

 // Normal mode: fluid sizing
 .weekly-schedule.horizontal .events-grid {
   grid-template-columns: repeat(var(--num-columns, 8), 1fr);
 }

 // Zoomed horizontal: fixed column width per hour
 .weekly-schedule.zoomed.horizontal .events-grid {
   grid-template-columns: repeat(var(--num-columns, 8), var(--hour-col-width, 160px));
   width: max-content;
 }

 .weekly-schedule.zoomed.vertical .events-grid {
   grid-template-rows: repeat(var(--num-rows, 8), var(--slot-row-height, 48px));
   height: max-content;
 }

 /* GRID LINES - NORMAL MODE */
 /* Horizontal orientation vertical lines */
 .weekly-schedule.horizontal .axis-horizontal,
 .weekly-schedule.horizontal .events-grid {
   position: relative;
 }
 .weekly-schedule.horizontal .axis-horizontal::before,
 .weekly-schedule.horizontal .events-grid::before {
   @include grid-line-pseudo;
   background-repeat: no-repeat;
   background-size: 100% 100%;
   background-image: repeating-linear-gradient(
     to right,
     transparent 0,
     transparent calc((100% / var(--num-columns)) - var(--line-thickness, 1px)),
     var(--schedule-grid-line-color, $color-border) calc((100% / var(--num-columns)) - var(--line-thickness, 1px)),
     var(--schedule-grid-line-color, $color-border) calc(100% / var(--num-columns))
   );
 }

 /* Horizontal orientation: add horizontal day separator lines (not in zoomed mode since only one day visible) */
 .weekly-schedule.horizontal:not(.zoomed) .events-grid::after {
   @include grid-line-pseudo;
   background-repeat: no-repeat;
   background-size: 100% 100%;
   background-image: repeating-linear-gradient(
     to bottom,
     transparent 0,
     transparent calc((100% / var(--num-rows)) - var(--line-thickness, 1px)),
     var(--schedule-grid-line-color, $color-border) calc((100% / var(--num-rows)) - var(--line-thickness, 1px)),
     var(--schedule-grid-line-color, $color-border) calc(100% / var(--num-rows))
   );
 }
 /* Vertical orientation horizontal lines */
 .weekly-schedule.vertical .axis-vertical,
 .weekly-schedule.vertical .events-grid { position: relative; }
 .weekly-schedule.vertical .axis-vertical::before,
 .weekly-schedule.vertical .events-grid::before {
   @include grid-line-pseudo;
   background-repeat: no-repeat;
   background-size: 100% 100%;
   background-image: repeating-linear-gradient(
     to bottom,
     transparent 0,
     transparent calc((100% / var(--num-rows)) - var(--line-thickness, 1px)),
     var(--schedule-grid-line-color, $color-border) calc((100% / var(--num-rows)) - var(--line-thickness, 1px)),
     var(--schedule-grid-line-color, $color-border) calc(100% / var(--num-rows))
   );
 }

 /* GRID LINES - ZOOMED MODE (FIXED SIZES) */
 .weekly-schedule.zoomed.horizontal .axis-horizontal::before,
 .weekly-schedule.zoomed.horizontal .events-grid::before {
   background-image: repeating-linear-gradient(
     to right,
     transparent 0,
     transparent calc(var(--hour-col-width, 160px) - var(--line-thickness, 1px)),
     var(--schedule-grid-line-color, $color-border) calc(var(--hour-col-width, 160px) - var(--line-thickness, 1px)),
     var(--schedule-grid-line-color, $color-border) var(--hour-col-width, 160px)
   );
 }
 .weekly-schedule.zoomed.vertical .axis-vertical::before,
 .weekly-schedule.zoomed.vertical .events-grid::before {
   background-image: repeating-linear-gradient(
     to bottom,
     transparent 0,
     transparent calc(var(--slot-row-height, 48px) - var(--line-thickness, 1px)),
     var(--schedule-grid-line-color, $color-border) calc(var(--slot-row-height, 48px) - var(--line-thickness, 1px)),
     var(--schedule-grid-line-color, $color-border) var(--slot-row-height, 48px)
   );
 }



